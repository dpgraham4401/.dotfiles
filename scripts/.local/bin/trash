#!/bin/bash
# wrapper for normal rm command that archives

usage() {
  echo "Remove Command Wrapper that archives"
  echo "Default archive is $Home/.Trash for Mac and $Home/.local/share/Trash for Linux"
  echo "Usage: $0 [-dfiPRrvW] file ..."
  echo "  -d  Remove directories"
  echo "  -f  Force"
  echo "  -i  Interactive"
  echo "  -P  Don't follow symlinks"
  echo "  -R  Recursive"
  echo "  -r  Recursive"
  echo "  -v  Verbose"
  echo "  -W  Writable"
}


if [[ "$OSTYPE" == "darwin"* ]]; then
	archivedir="$HOME/.Trash"
else
	archivedir="$HOME/.local/share/Trash"
fi

realrm="$(which rm)"
copy="$(which cp) -R"

if [ $# -eq 0 ] ; then  
  exec $realrm 
fi

flags=""


while getopts "dfiPRrvWh" opt
do
  case $opt in
    f ) exec $realrm "$@"     ;;  
	h ) usage; exit 0         ;;
    * ) flags="$flags -$opt"  ;; 
  esac
done
shift $(( $OPTIND - 1 ))

for arg 
do
  newname="$archivedir/$(basename "$arg").$(date "+%m-%d.%H.%M.%S")"
  if [ -d "$arg" ] ; then
    $copy "$arg" "$newname"	
    $realrm "-rf" "$arg"
  fi
  if [ -f "$arg" -o -d "$arg" ] ; then
    $copy "$arg" "$newname"	
    $realrm $flags "$arg"
  fi
done

# exec $realrm $flags "$@"
